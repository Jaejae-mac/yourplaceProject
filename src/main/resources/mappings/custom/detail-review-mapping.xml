<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ReviewMapper">
	<resultMap type="detailReviewVO" id="detailReviewtList">
		<result property="rowNum" column="no" />
		<result property="rsvNum" column="rsv_num" />
		<result property="userId" column="user_id" />
		<result property="placeNum" column="place_num" />
		<result property="reviewGuestRate" column="review_guest_rate" />
		<result property="reviewGuestWr" column="review_guest_wr" />
		<result property="reviewGuestRegd" column="review_guest_regd" />
		<result property="help_cnt" column="helpCnt" />
		<result property="userNickName" column="user_nick_name" />
	</resultMap>
	<!-- 리뷰 목록을 불러올 쿼리.5개씩 끊어서 가져온다. -->
	<select id="getReviewList" resultMap="detailReviewtList">
		SELECT b.* FROM (
			SELECT @rownum:=@rownum+1 as no, 
				a.rsv_num,
        		a.user_id,
        		a.place_num,
        		a.review_guest_wr,
        		a.review_guest_rate,
        		a.help_cnt,
        		DATE_FORMAT(a.review_guest_regd, '%Y. %m. %d') as review_guest_regd,
				(select user_nick_name from member where user_id = a.user_id) as user_nick_name
					from reviewGuest a, (select @rownum:=0) temp
					where place_num = #{placeNum}
					order by review_guest_regd ) b
			where b.no > #{rowNum}
			limit 5;
	</select>
</mapper>